#  CRMEB-CVE-2024-52726-任意文件下载漏洞分析  
寻梦安全  寻梦安全   2025-06-25 08:23  
  
点击蓝字 关注我们  
  
  
  
**免责说明**  
  
由于传播、利用本公众号寻梦安全所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号寻梦安全及作者不为此承担任何责任，一旦造成后果请自行承担！如有侵权烦请告知，我们会立即删除并致歉。谢谢！  
  
  
  
漏洞分析  
  
该系统采用前后端分离技术，基于ThinkPHP6+elementUI+Uni-app框架开发  
  
首先我们查看路由，看到这是一个后台的任意文件下载，并且/adminapi/setting/config/save_basics路径会进去到 v1.setting.SystemConfig/save_basics 这个路径下  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDh8KfFXkbjoPSEOCELvJrfr7Zxhd8APDKNpted1EZwB5iaqLy2aVQnCpw/640?wx_fmt=png "")  
  
受影响的代码在app/adminapi/controllerv1.setting.SystemConfig/save_basics.php文件的save_basics中  
  
这里从请求中获取 POST 参数，然后遍历 POST 数据的每个键值对，$k 表示字段名，$v 表示字段值。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDhuoS6ye8A7xTdIS9O7BBkG0ibicbdJGjo0p2KG92xY6scHvWNAg66aibUA/640?wx_fmt=png "")  
  
接着是一系列的判断，判断post参数是否存在这些，然后在weixin_ckeck_filepost参数中，存在copy函数，可以将文件进行复制的一个操作  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDhibg6DT4XFrJWuZGG5ia8TbrFTTMhq9tCasJUEjnSvcib22hqUqbTibL58w/640?wx_fmt=png "")  
  
接着跟踪代码，发现public_path就是在public目录，这里存在copy文件到public目录下的一个操作  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDhD2GEK02eeD3KCzOvl9Wbcbk1jJnZIo0iblazpyAaL8aT3TLQvDHGfwQ/640?wx_fmt=png "")  
  
分析$to = public_path() . array_reverse(explode('/', $post['weixin_ckeck_file']))[0];这个代码，就是将字符串按 / 分割成一个数组，然后提取最后一个部分（就是文件名），然后拼接到public目录下  
  
进行动调一下，看看是否和我们之前描述的一样。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDhp8ia4Yb05DJ4voX7ricTBKjLyye0sUWO1TWAJ9t1wFvXPzApyZlSDrXQ/640?wx_fmt=png "")  
  
可以看到，结果就是我们所描述的那种。并且由于是thinkphp的框架，所以运行的目录也是在public目录下面。因此可以直接去访问那个文件，便可以进行下载文件。  
  
exp:  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDhRx5I7Fl1G8iagSy5RaRU71bKtDYgrUvjOmm4f6InmGzvAUZRBHQEjEg/640?wx_fmt=png "")  
  
然后访问直接win.ini便可以下载win.ini文件  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fzlloB4t1N5P4AgsP66oQZzveTiaCVQDhVBM3HEWlouLyEDK7My9DzpWcauYBfFcOrr5BfEEDe4jkgWJVIlf21A/640?wx_fmt=png "")  
  
  
  
总结  
  
这是一个由于copy函数没有严格控制路径问题，导致存在一个任意文件下载的操作。  
  
